-- First load the loading screen
loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/Loadingscreen"))()

-- Wait for loading screen to finish (adjust timing as needed)
wait(3) -- You can adjust this delay based on how long the loading screen takes

--[[ LUA UI SCRIPT: WarpahVip GUI Cheat Menu - Enhanced Fixed Version (with WarpahMorph) ]]
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local player = game.Players.LocalPlayer
local RunService = game:GetService("RunService")

-- Enhanced cleanup function
local function cleanupExistingGUI()
    pcall(function()
        local existingGUI = player.PlayerGui:FindFirstChild("WarpahVipGUI")
        if existingGUI then
            existingGUI:Destroy()
        end
        
        -- Also cleanup any orphaned blur effects
        local lighting = game:GetService("Lighting")
        for _, effect in pairs(lighting:GetChildren()) do
            if effect:IsA("BlurEffect") and effect.Name == "WarpahVipBlur" then
                effect:Destroy()
            end
        end
    end)
end

cleanupExistingGUI()

-- Wait for PlayerGui to be ready
local playerGui = player:WaitForChild("PlayerGui")

local gui = Instance.new("ScreenGui")
gui.Name = "WarpahVipGUI"
gui.ResetOnSpawn = false
gui.IgnoreGuiInset = true
gui.Parent = playerGui

-- Blur effect with error handling and proper naming
local blur = nil
pcall(function()
    blur = Instance.new("BlurEffect")
    blur.Name = "WarpahVipBlur"
    blur.Size = 0
    blur.Enabled = false
    blur.Parent = game:GetService("Lighting")
end)

-- Main logo button (improved design)
local logo = Instance.new("Frame")
logo.Size = UDim2.new(0, 50, 0, 50)
logo.Position = UDim2.new(0, 20, 0, 100)
logo.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
logo.Active = true
logo.Parent = gui

-- Logo styling
local logoCorner = Instance.new("UICorner")
logoCorner.CornerRadius = UDim.new(0, 12)
logoCorner.Parent = logo

local logoStroke = Instance.new("UIStroke")
logoStroke.Color = Color3.fromRGB(0, 255, 100)
logoStroke.Thickness = 2
logoStroke.Parent = logo

-- Logo gradient background
local logoGradient = Instance.new("UIGradient")
logoGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 80, 30)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 60, 20)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 40, 15))
}
logoGradient.Rotation = 45
logoGradient.Parent = logo

-- Logo clickable button (fixed for dragging)
local logoButton = Instance.new("TextButton")
logoButton.Size = UDim2.new(1, 0, 1, 0)
logoButton.Position = UDim2.new(0, 0, 0, 0)
logoButton.BackgroundTransparency = 1
logoButton.Text = ""
logoButton.Active = false -- Important: Set to false to allow dragging
logoButton.Parent = logo

-- Logo icon
local logoIcon = Instance.new("TextLabel")
logoIcon.Size = UDim2.new(1, 0, 0.6, 0)
logoIcon.Position = UDim2.new(0, 0, 0, 0)
logoIcon.BackgroundTransparency = 1
logoIcon.Text = "‚ö°"
logoIcon.TextColor3 = Color3.fromRGB(0, 255, 100)
logoIcon.Font = Enum.Font.GothamBold
logoIcon.TextSize = 24
logoIcon.TextXAlignment = Enum.TextXAlignment.Center
logoIcon.TextYAlignment = Enum.TextYAlignment.Center
logoIcon.Parent = logo

-- Logo text
local logoText = Instance.new("TextLabel")
logoText.Size = UDim2.new(1, 0, 0.4, 0)
logoText.Position = UDim2.new(0, 0, 0.6, 0)
logoText.BackgroundTransparency = 1
logoText.Text = "VIP"
logoText.TextColor3 = Color3.fromRGB(255, 255, 255)
logoText.Font = Enum.Font.GothamBold
logoText.TextSize = 12
logoText.TextXAlignment = Enum.TextXAlignment.Center
logoText.TextYAlignment = Enum.TextYAlignment.Center
logoText.Parent = logo

-- Logo glow effect
local logoGlow = Instance.new("Frame")
logoGlow.Size = UDim2.new(1, 20, 1, 20)
logoGlow.Position = UDim2.new(0, -10, 0, -10)
logoGlow.BackgroundColor3 = Color3.fromRGB(0, 255, 100)
logoGlow.BackgroundTransparency = 0.9
logoGlow.ZIndex = -1
logoGlow.Parent = logo

local logoGlowCorner = Instance.new("UICorner")
logoGlowCorner.CornerRadius = UDim.new(0, 20)
logoGlowCorner.Parent = logoGlow

-- Main menu frame (with minimum size constraints)
local menu = Instance.new("Frame")
menu.Size = UDim2.new(0, 420, 0, 280)
menu.Position = UDim2.new(0.5, -210, 0.5, -140)
menu.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
menu.Visible = false
menu.Active = true
menu.Parent = gui

-- Menu styling
local menuCorner = Instance.new("UICorner")
menuCorner.CornerRadius = UDim.new(0, 12)
menuCorner.Parent = menu

local menuStroke = Instance.new("UIStroke")
menuStroke.Color = Color3.fromRGB(0, 255, 0)
menuStroke.Thickness = 2
menuStroke.Parent = menu

-- Menu gradient
local menuGradient = Instance.new("UIGradient")
menuGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(20, 20, 20)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(30, 30, 30))
}
menuGradient.Rotation = 90
menuGradient.Parent = menu

-- Resize handle (bottom-right corner) - Fixed with proper resize icon
local resizeHandle = Instance.new("Frame")
resizeHandle.Size = UDim2.new(0, 20, 0, 20)
resizeHandle.Position = UDim2.new(1, -20, 1, -20)
resizeHandle.BackgroundTransparency = 1
resizeHandle.Parent = menu

-- Resize lines (proper resize indicator)
local resizeLine1 = Instance.new("Frame")
resizeLine1.Size = UDim2.new(0, 12, 0, 2)
resizeLine1.Position = UDim2.new(0, 4, 0, 14)
resizeLine1.BackgroundColor3 = Color3.fromRGB(150, 150, 150)
resizeLine1.BorderSizePixel = 0
resizeLine1.Parent = resizeHandle

local resizeLine2 = Instance.new("Frame")
resizeLine2.Size = UDim2.new(0, 8, 0, 2)
resizeLine2.Position = UDim2.new(0, 8, 0, 10)
resizeLine2.BackgroundColor3 = Color3.fromRGB(150, 150, 150)
resizeLine2.BorderSizePixel = 0
resizeLine2.Parent = resizeHandle

local resizeLine3 = Instance.new("Frame")
resizeLine3.Size = UDim2.new(0, 4, 0, 2)
resizeLine3.Position = UDim2.new(0, 12, 0, 6)
resizeLine3.BackgroundColor3 = Color3.fromRGB(150, 150, 150)
resizeLine3.BorderSizePixel = 0
resizeLine3.Parent = resizeHandle

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -80, 0, 40)
title.Position = UDim2.new(0, 40, 0, 5)
title.BackgroundTransparency = 1
title.Text = "WarpahVip | v.0.4.0.0"
title.TextColor3 = Color3.fromRGB(0, 255, 0)
title.TextSize = 16
title.Font = Enum.Font.GothamBold
title.TextXAlignment = Enum.TextXAlignment.Center
title.Parent = menu

-- Close button (X style)
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -35, 0, 5)
closeBtn.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
closeBtn.Text = "√ó"
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.TextSize = 20
closeBtn.Font = Enum.Font.GothamBold
closeBtn.Parent = menu

local closeBtnCorner = Instance.new("UICorner")
closeBtnCorner.CornerRadius = UDim.new(0, 4)
closeBtnCorner.Parent = closeBtn

-- Minimize button (- style)
local minBtn = Instance.new("TextButton")
minBtn.Size = UDim2.new(0, 30, 0, 30)
minBtn.Position = UDim2.new(1, -70, 0, 5)
minBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
minBtn.Text = "‚àí"
minBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
minBtn.TextSize = 20
minBtn.Font = Enum.Font.GothamBold
minBtn.Parent = menu

local minBtnCorner = Instance.new("UICorner")
minBtnCorner.CornerRadius = UDim.new(0, 4)
minBtnCorner.Parent = minBtn

-- Sidebar
local side = Instance.new("Frame")
side.Size = UDim2.new(0, 110, 1, -50)
side.Position = UDim2.new(0, 10, 0, 50)
side.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
side.Parent = menu

local sideCorner = Instance.new("UICorner")
sideCorner.CornerRadius = UDim.new(0, 8)
sideCorner.Parent = side

-- Cheat button
local cheatBtn = Instance.new("TextButton")
cheatBtn.Size = UDim2.new(1, -10, 0, 40)
cheatBtn.Position = UDim2.new(0, 5, 0, 10)
cheatBtn.Text = "üéÆ Cheat"
cheatBtn.BackgroundColor3 = Color3.fromRGB(0, 50, 0)
cheatBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
cheatBtn.Font = Enum.Font.GothamBold
cheatBtn.TextSize = 14
cheatBtn.Parent = side

local cheatBtnCorner = Instance.new("UICorner")
cheatBtnCorner.CornerRadius = UDim.new(0, 8)
cheatBtnCorner.Parent = cheatBtn

-- Device button (new)
local deviceBtn = Instance.new("TextButton")
deviceBtn.Size = UDim2.new(1, -10, 0, 40)
deviceBtn.Position = UDim2.new(0, 5, 0, 60)
deviceBtn.Text = "üì± Device"
deviceBtn.BackgroundColor3 = Color3.fromRGB(0, 50, 0)
deviceBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
deviceBtn.Font = Enum.Font.GothamBold
deviceBtn.TextSize = 14
deviceBtn.Parent = side

local deviceBtnCorner = Instance.new("UICorner")
deviceBtnCorner.CornerRadius = UDim.new(0, 8)
deviceBtnCorner.Parent = deviceBtn

-- Clear button (moved down)
local clearBtn = Instance.new("TextButton")
clearBtn.Size = UDim2.new(1, -10, 0, 40)
clearBtn.Position = UDim2.new(0, 5, 0, 110)
clearBtn.Text = "üßπ Clear"
clearBtn.BackgroundColor3 = Color3.fromRGB(0, 50, 0)
clearBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
clearBtn.Font = Enum.Font.GothamBold
clearBtn.TextSize = 14
clearBtn.Parent = side

local clearBtnCorner = Instance.new("UICorner")
clearBtnCorner.CornerRadius = UDim.new(0, 8)
clearBtnCorner.Parent = clearBtn

-- Back button
local backBtn = Instance.new("TextButton")
backBtn.Size = UDim2.new(1, -10, 0, 35)
backBtn.Position = UDim2.new(0, 5, 1, -45)
backBtn.BackgroundColor3 = Color3.fromRGB(0, 70, 0)
backBtn.Text = "‚Üê Kembali"
backBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
backBtn.Font = Enum.Font.Gotham
backBtn.TextSize = 13
backBtn.Visible = false
backBtn.Parent = side

local backBtnCorner = Instance.new("UICorner")
backBtnCorner.CornerRadius = UDim.new(0, 6)
backBtnCorner.Parent = backBtn

-- Content area
local content = Instance.new("ScrollingFrame")
content.Size = UDim2.new(1, -130, 1, -60)
content.Position = UDim2.new(0, 130, 0, 50)
content.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
content.ScrollBarThickness = 6
content.ScrollBarImageColor3 = Color3.fromRGB(0, 255, 0)
content.CanvasSize = UDim2.new(0, 0, 0, 0)
content.AutomaticCanvasSize = Enum.AutomaticSize.Y
content.Parent = menu

local contentCorner = Instance.new("UICorner")
contentCorner.CornerRadius = UDim.new(0, 8)
contentCorner.Parent = content

local contentLayout = Instance.new("UIListLayout")
contentLayout.SortOrder = Enum.SortOrder.LayoutOrder
contentLayout.Padding = UDim.new(0, 5)
contentLayout.Parent = content

local contentPadding = Instance.new("UIPadding")
contentPadding.PaddingTop = UDim.new(0, 10)
contentPadding.PaddingLeft = UDim.new(0, 10)
contentPadding.PaddingRight = UDim.new(0, 10)
contentPadding.Parent = content

-- Safe GUI clearing function
local function clearContent()
    for _, child in pairs(content:GetChildren()) do
        if child:IsA("GuiObject") and child ~= contentLayout and child ~= contentPadding then
            child:Destroy()
        end
    end
end

-- Create button function with error handling
local function createButton(text, callback, color)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -20, 0, 35)
    btn.BackgroundColor3 = color or Color3.fromRGB(20, 70, 20)
    btn.Text = text
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.TextSize = 13
    btn.Font = Enum.Font.Gotham
    btn.Parent = content
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 6)
    btnCorner.Parent = btn
    
    if callback then
        btn.MouseButton1Click:Connect(function()
            pcall(callback) -- Safe callback execution
        end)
    end
    
    return btn
end

-- Server Hop function with enhanced error handling
local function serverHop()
    pcall(function()
        print("üîÑ Starting server hop...")
        local TeleportService = game:GetService("TeleportService")
        local HttpService = game:GetService("HttpService")
        local placeId = game.PlaceId
        
        -- Notify user
        local notification = Instance.new("Frame")
        notification.Size = UDim2.new(0, 300, 0, 80)
        notification.Position = UDim2.new(0.5, -150, 0, 50)
        notification.BackgroundColor3 = Color3.fromRGB(0, 120, 0)
        notification.Parent = gui
        
        local notifCorner = Instance.new("UICorner")
        notifCorner.CornerRadius = UDim.new(0, 8)
        notifCorner.Parent = notification
        
        local notifText = Instance.new("TextLabel")
        notifText.Size = UDim2.new(1, 0, 1, 0)
        notifText.BackgroundTransparency = 1
        notifText.Text = "üîÑ Finding new server...\nPlease wait..."
        notifText.TextColor3 = Color3.fromRGB(255, 255, 255)
        notifText.Font = Enum.Font.GothamBold
        notifText.TextSize = 14
        notifText.Parent = notification
        
        -- Try to get server list and teleport
        local success, errorMessage = pcall(function()
            -- Simple server hop - teleport to same place which should find different server
            wait(2) -- Give user time to see notification
            TeleportService:Teleport(placeId, player)
        end)
        
        if not success then
            -- Fallback: Simple rejoin
            print("‚ö†Ô∏è Server hop failed, using rejoin instead")
            notifText.Text = "‚ö†Ô∏è Server hop failed\nRejoining current server..."
            wait(2)
            TeleportService:Teleport(placeId, player)
        end
    end)
end

-- Auto peak menu - FIXED: Now directly loads the script instead of submenu
local function showAutoPuncak()
    clearContent()
    currentMenu = "main" -- Stay in main menu
    
    -- Directly load the AutoSummit script
    print("üèîÔ∏è Loading Auto Summit...")
    loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/AutoSummit"))()
    
    backBtn.Visible = false
end

-- Fly mode menu (Fixed with loadstring)
local function showFlyMenu()
    clearContent()
    currentMenu = "fly"
    
    local flyItems = {
        { 
            label = "‚úàÔ∏è Fly v1 (No Clip)", 
            callback = function()
                print("üöÄ Loading Fly No Clip...")
                loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/Fly%20No%20Clip"))()
            end 
        },
        { 
            label = "‚úàÔ∏è Fly v2 (Safe)", 
            callback = function() 
                print("üöÄ Loading Fly Safe...")
                loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/FlySafee"))()
            end 
        },
    }

    for _, item in ipairs(flyItems) do
        createButton(item.label, item.callback, Color3.fromRGB(30, 70, 120))
    end
    backBtn.Visible = true
end

-- Speed Run menu with submenu (NEW)
local function showSpeedMenu()
    clearContent()
    currentMenu = "speed"
    
    local speedItems = {
        { 
            label = "‚ö° Speed Hack V1", 
            callback = function()
                print("‚ö° Loading Speed Hack V1...")
                loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/Speedrun"))()
            end 
        },
        { 
            label = "‚ö° Speed Hack V2", 
            callback = function() 
                print("‚ö° Loading Speed Hack V2...")
                loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/SpeedRunCframe"))()
            end 
        },
    }

    for _, item in ipairs(speedItems) do
        createButton(item.label, item.callback, Color3.fromRGB(120, 80, 20))
    end
    backBtn.Visible = true
end

-- NEW: Infinite Jump menu - FIXED: Now directly loads script
local function showInfiniteJumpMenu()
    clearContent()
    currentMenu = "main" -- Stay in main menu
    
    -- Directly load the InfiniteJump script
    print("ü¶ò Loading Infinite Jump...")
    loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/InfiniteJump"))()
    
    backBtn.Visible = false
end

-- Fling Player menu - FIXED: Now has two submenus
local function showFlingMenu()
    clearContent()
    currentMenu = "fling"
    
    local flingItems = {
        { 
            label = "üí• Fling All Player", 
            callback = function()
                print("üí• Loading Fling All Player...")
                loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/FlingAll"))()
            end 
        },
        { 
            label = "üö∂ Walkfling", 
            callback = function() 
                print("üö∂ Loading Walkfling...")
                loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/Walkfling"))()
            end 
        },
    }

    for _, item in ipairs(flingItems) do
        createButton(item.label, item.callback, Color3.fromRGB(120, 40, 40))
    end
    backBtn.Visible = true
end

-- Device menu function (Enhanced with Server Hop and Boost FPS)
local function showDeviceMenu()
    clearContent()
    currentMenu = "device"
    
    local deviceItems = {
        { 
            label = "üîß Device Spoof", 
            callback = function()
                print("üîß Loading Device Spoof...")
                loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/DeviceSpoof"))()
            end 
        },
        { 
            label = "üîÑ Rejoin Server", 
            callback = function()
                print("üîÑ Rejoining server...")
                local TeleportService = game:GetService("TeleportService")
                local placeId = game.PlaceId
                TeleportService:Teleport(placeId, player)
            end 
        },
        { 
            label = "üåê Server Hop", 
            callback = function()
                serverHop()
            end 
        },
        { 
            label = "‚ö° Boost FPS", 
            callback = function()
                print("‚ö° Loading Boost FPS...")
                loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/BoosterFPSVIP"))()
            end 
        },
        { 
            label = "üëÆ Detect Admin", 
            callback = function()
                print("üëÆ Loading Detect Admin...")
                loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/DetectAdmin"))()
            end 
        },
        { 
            label = "üîç Dex Explorer", 
            callback = function()
                print("üîç Loading Dex Explorer...")
                loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/Dex%20Explorer.lua.txt"))()
            end 
        },
    }

    for _, item in ipairs(deviceItems) do
        createButton(item.label, item.callback, Color3.fromRGB(40, 60, 80))
    end
    backBtn.Visible = true
end

-- Hide Name Visual menu - FIXED: Now directly loads script
local function showHideNameMenu()
    clearContent()
    currentMenu = "main" -- Stay in main menu
    
    -- Directly load the HideNameVisual script
    print("üé≠ Loading Hide Name Visual...")
    loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/HideNameVisual"))()
    
    backBtn.Visible = false
end

-- NEW: Spectate Player menu - FIXED: Now directly loads script
local function showSpectatePlayerMenu()
    clearContent()
    currentMenu = "main" -- Stay in main menu
    
    -- Directly load the SpectateWarpah script
    print("üëÅÔ∏è Loading Spectate Player...")
    loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/SpectateWarpah"))()
    
    backBtn.Visible = false
end

-- NEW: WarpahMorph menu - FIXED: Now directly loads script
local function showWarpahMorphMenu()
    clearContent()
    currentMenu = "main" -- Stay in main menu
    
    -- Directly load the WarpahMorph script
    print("ü¶ã Loading WarpahMorph...")
    loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/WarpahMorph"))()
    
    backBtn.Visible = false
end

-- NEW: Warpah Carry menu - FIXED: Now directly loads script
local function showWarpahCarryMenu()
    clearContent()
    currentMenu = "main" -- Stay in main menu
    
    -- Directly load the Bypass Carry script
    print("üéí Loading Warpah Carry...")
    loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/Bypass%20Carry"))()
    
    backBtn.Visible = false
end

-- NEW: Warpah RTX menu - FIXED: Now directly loads script
local function showWarpahRTXMenu()
    clearContent()
    currentMenu = "main" -- Stay in main menu
    
    -- Directly load the WarpahRtx script
    print("üåü Loading Warpah RTX...")
    loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/WarpahRtx"))()
    
    backBtn.Visible = false
end

-- NEW: No Clip menu - FIXED: Now directly loads script
local function showNoClipMenu()
    clearContent()
    currentMenu = "main" -- Stay in main menu
    
    -- Directly load the No Clip Bypass script
    print("üëª Loading No Clip...")
    loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/No%20clip%20bypass"))()
    
    backBtn.Visible = false
end

-- NEW: Teleport menu - FIXED: Now directly loads script
local function showTeleportMenu()
    clearContent()
    currentMenu = "main" -- Stay in main menu
    
    -- Directly load the WarpahTeleport script
    print("üöÄ Loading Teleport...")
    loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/WarpahTeleport"))()
    
    backBtn.Visible = false
end

local function showCheats()
    clearContent()
    currentMenu = "main"
    
    local items = {
        { label = "üèîÔ∏è Auto Puncak", callback = showAutoPuncak },
        { label = "‚úàÔ∏è Fly Mode", callback = showFlyMenu },
        { label = "üèÉ Speed Run", callback = showSpeedMenu },
        { label = "ü¶ò Infinite Jump", callback = showInfiniteJumpMenu },
        { label = "‚ú® Radiant Body", callback = function()
            print("‚ú® Loading Radiant Body...")
            loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/Radiant%20body"))()
        end },
        { label = "üéØ Fling Player", callback = showFlingMenu },
        { label = "üë§ TP to Player", callback = function() 
            print("üë§ Loading TP to Player...")
            loadstring(game:HttpGet("https://raw.githubusercontent.com/businessmanalex88-stack/BypassWhoAmI/refs/heads/main/TptoPlayer"))()
        end },
        { label = "üé≠ Hide Name Visual", callback = showHideNameMenu },
        { label = "üëÅÔ∏è Spectate Player", callback = showSpectatePlayerMenu },
        { label = "ü¶ã WarpahMorph", callback = showWarpahMorphMenu },
        { label = "üéí Warpah Carry", callback = showWarpahCarryMenu },
        { label = "üåü Warpah RTX", callback = showWarpahRTXMenu },
        { label = "üëª No Clip", callback = showNoClipMenu },
        { label = "üöÄ Teleport", callback = showTeleportMenu },
    }

    for _, item in ipairs(items) do
        createButton(item.label, item.callback, Color3.fromRGB(45, 45, 45))
    end
    backBtn.Visible = false
end

-- Event connections with error handling
local function safeConnect(signal, callback)
    return signal:Connect(function(...)
        pcall(callback, ...)
    end)
end

-- Enhanced dragging system with better error handling
local function makeDraggable(frame)
    pcall(function()
        local dragToggle = false
        local dragStart = nil
        local startPos = nil
        
        -- For menu, use title area. For logo, use the frame itself
        local dragArea = (frame == menu) and title or frame
        
        local dragConnection = nil
        local inputConnection = nil
        
        dragConnection = safeConnect(dragArea.InputBegan, function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                dragToggle = true
                dragStart = input.Position
                startPos = frame.Position
                
                if inputConnection then
                    inputConnection:Disconnect()
                end
                
                inputConnection = safeConnect(input.Changed, function()
                    if input.UserInputState == Enum.UserInputState.End then 
                        dragToggle = false 
                    end
                end)
            end
        end)
        
        safeConnect(UIS.InputChanged, function(input)
            if dragToggle and dragStart and startPos and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                local delta = input.Position - dragStart
                frame.Position = UDim2.new(
                    startPos.X.Scale, 
                    startPos.X.Offset + delta.X, 
                    startPos.Y.Scale, 
                    startPos.Y.Offset + delta.Y
                )
            end
        end)
    end)
end

-- Enhanced resize system with better error handling
local function makeResizable(frame, minWidth, minHeight)
    pcall(function()
        local resizing = false
        local startSize = nil
        local startPos = nil
        local resizeConnection = nil
        
        resizeConnection = safeConnect(resizeHandle.InputBegan, function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                resizing = true
                startSize = frame.Size
                startPos = input.Position
                
                safeConnect(input.Changed, function()
                    if input.UserInputState == Enum.UserInputState.End then 
                        resizing = false 
                    end
                end)
            end
        end)
        
        safeConnect(UIS.InputChanged, function(input)
            if resizing and startSize and startPos and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                local delta = input.Position - startPos
                local newWidth = math.max(minWidth or 350, startSize.X.Offset + delta.X)
                local newHeight = math.max(minHeight or 250, startSize.Y.Offset + delta.Y)
                
                frame.Size = UDim2.new(0, newWidth, 0, newHeight)
            end
        end)
    end)
end

-- Current menu tracker
local currentMenu = "main"

-- Button events
safeConnect(cheatBtn.MouseButton1Click, function()
    showCheats()
end)

safeConnect(deviceBtn.MouseButton1Click, function()
    showDeviceMenu()
end)

safeConnect(backBtn.MouseButton1Click, function()
    if currentMenu == "fly" or currentMenu == "hidename" or currentMenu == "fling" or currentMenu == "device" or currentMenu == "speed" then
        showCheats()
    else
        showCheats()
    end
end)

-- FIXED CLEAR FUNCTION - Safe cleanup without external scripts
safeConnect(clearBtn.MouseButton1Click, function()
    pcall(function()
        -- Simple hide menu and disable blur
        menu.Visible = false
        logo.Visible = true
        
        if blur then
            blur.Enabled = false
            blur.Size = 0
        end
        
        -- Clear content safely
        clearContent()
        
        print("‚úÖ GUI cleared successfully")
    end)
end)

safeConnect(logoButton.MouseButton1Click, function()
    pcall(function()
        menu.Visible = true
        if blur then
            blur.Enabled = true
            local tween = TweenService:Create(blur, TweenInfo.new(0.3, Enum.EasingStyle.Quad), { Size = 12 })
            tween:Play()
        end
        showCheats()
    end)
end)

safeConnect(minBtn.MouseButton1Click, function()
    pcall(function()
        menu.Visible = false
        if blur then
            blur.Enabled = false
            blur.Size = 0
        end
    end)
end)

safeConnect(closeBtn.MouseButton1Click, function()
    pcall(function()
        menu.Visible = false
        logo.Visible = false
        if blur then
            blur.Enabled = false
            blur.Size = 0
        end
    end)
end)

-- Logo pulsing animation with error handling
local function animateLogo()
    pcall(function()
        if logoGlow and logoIcon then
            local pulseIn = TweenService:Create(logoGlow, 
                TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), 
                { BackgroundTransparency = 0.7 }
            )
            pulseIn:Play()
            
            local iconPulse = TweenService:Create(logoIcon, 
                TweenInfo.new(2, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), 
                { TextSize = 28 }
            )
            iconPulse:Play()
        end
    end)
end

-- Apply dragging and resizing
makeDraggable(menu)
makeDraggable(logo) -- Fixed logo dragging
makeResizable(menu, 350, 250)

-- Start logo animation
animateLogo()

-- Initialize with main menu
showCheats()

-- Enhanced cleanup on player leaving with better error handling
safeConnect(player.AncestryChanged, function()
    if not player.Parent then
        pcall(function()
            -- Cleanup blur effect
            if blur and blur.Parent then
                blur:Destroy()
            end
            
            -- Cleanup GUI
            if gui and gui.Parent then
                gui:Destroy()
            end
            
            -- Additional cleanup for any orphaned effects
            local lighting = game:GetService("Lighting")
            for _, effect in pairs(lighting:GetChildren()) do
                if effect:IsA("BlurEffect") and effect.Name == "WarpahVipBlur" then
                    effect:Destroy()
                end
            end
        end)
    end
end)

-- Additional safety: Cleanup on script end
local function onScriptEnd()
    pcall(function()
        if blur and blur.Parent then
            blur:Destroy()
        end
        if gui and gui.Parent then
            gui:Destroy()
        end
    end)
end

-- Register cleanup
game:GetService("RunService").Heartbeat:Connect(function()
    if not gui or not gui.Parent then
        onScriptEnd()
    end
end)

print("‚úÖ WarpahVip GUI v0.3.3.4 Enhanced loaded successfully!")
print("‚ú® Updated Features:")
print("  - üèîÔ∏è Auto Puncak now directly loads AutoSummit script")
print("  - üí• Fling Player menu with Fling All Player & Walkfling")
print("  - üîç Dex Explorer added to Device menu")
print("  - ‚úàÔ∏è Fly No Clip & Fly Safe functional with loadstring")
print("  - üåê Server Hop feature added to Device menu")
print("  - ‚ö° Boost FPS added to Device menu") -- NEW FEATURE ADDED
print("  - üîß Device Spoof now loads DeviceSpoof script")
print("  - üëÆ Detect Admin now loads DetectAdmin script")
print("  - üë§ TP to Player now loads TptoPlayer script")
print("  - üé≠ Hide Name Visual now directly loads HideNameVisual script")
print("  - üëÅÔ∏è Spectate Player now directly loads SpectateWarpah script")
print("  - ü¶ã WarpahMorph now directly loads WarpahMorph script")
print("  - üéí Warpah Carry now directly loads Bypass Carry script") -- NEW FEATURE
print("  - üåü Warpah RTX now directly loads WarpahRtx script") -- NEW FEATURE
print("  - üëª No Clip now directly loads No Clip Bypass script")
print("  - üöÄ Teleport now directly loads WarpahTeleport script")
print("  - ü¶ò Infinite Jump now directly loads InfiniteJump script")
print("  - üèÉ Speed Run now has submenu with Speed Hack V1 & V2")
print("  - ‚ùå Aimbot menu removed completely")
print("  - üõ°Ô∏è Enhanced error handling and memory management")
print("üöÄ Ready to use!")
