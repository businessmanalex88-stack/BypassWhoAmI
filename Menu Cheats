--[[ LUA UI SCRIPT: WarpahVip GUI Cheat Menu - Enhanced Fixed Version ]]
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local player = game.Players.LocalPlayer
local RunService = game:GetService("RunService")

-- Enhanced cleanup function
local function cleanupExistingGUI()
    pcall(function()
        local existingGUI = player.PlayerGui:FindFirstChild("WarpahVipGUI")
        if existingGUI then
            existingGUI:Destroy()
        end
        
        -- Also cleanup any orphaned blur effects
        local lighting = game:GetService("Lighting")
        for _, effect in pairs(lighting:GetChildren()) do
            if effect:IsA("BlurEffect") and effect.Name == "WarpahVipBlur" then
                effect:Destroy()
            end
        end
    end)
end

cleanupExistingGUI()

-- Wait for PlayerGui to be ready
local playerGui = player:WaitForChild("PlayerGui")

local gui = Instance.new("ScreenGui")
gui.Name = "WarpahVipGUI"
gui.ResetOnSpawn = false
gui.IgnoreGuiInset = true
gui.Parent = playerGui

-- Blur effect with error handling and proper naming
local blur = nil
pcall(function()
    blur = Instance.new("BlurEffect")
    blur.Name = "WarpahVipBlur"
    blur.Size = 0
    blur.Enabled = false
    blur.Parent = game:GetService("Lighting")
end)

-- Main logo button (improved design)
local logo = Instance.new("Frame")
logo.Size = UDim2.new(0, 50, 0, 50)
logo.Position = UDim2.new(0, 20, 0, 100)
logo.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
logo.Active = true
logo.Parent = gui

-- Logo styling
local logoCorner = Instance.new("UICorner")
logoCorner.CornerRadius = UDim.new(0, 12)
logoCorner.Parent = logo

local logoStroke = Instance.new("UIStroke")
logoStroke.Color = Color3.fromRGB(0, 255, 100)
logoStroke.Thickness = 2
logoStroke.Parent = logo

-- Logo gradient background
local logoGradient = Instance.new("UIGradient")
logoGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 80, 30)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 60, 20)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 40, 15))
}
logoGradient.Rotation = 45
logoGradient.Parent = logo

-- Logo clickable button (fixed for dragging)
local logoButton = Instance.new("TextButton")
logoButton.Size = UDim2.new(1, 0, 1, 0)
logoButton.Position = UDim2.new(0, 0, 0, 0)
logoButton.BackgroundTransparency = 1
logoButton.Text = ""
logoButton.Active = false -- Important: Set to false to allow dragging
logoButton.Parent = logo

-- Logo icon
local logoIcon = Instance.new("TextLabel")
logoIcon.Size = UDim2.new(1, 0, 0.6, 0)
logoIcon.Position = UDim2.new(0, 0, 0, 0)
logoIcon.BackgroundTransparency = 1
logoIcon.Text = "‚ö°"
logoIcon.TextColor3 = Color3.fromRGB(0, 255, 100)
logoIcon.Font = Enum.Font.GothamBold
logoIcon.TextSize = 24
logoIcon.TextXAlignment = Enum.TextXAlignment.Center
logoIcon.TextYAlignment = Enum.TextYAlignment.Center
logoIcon.Parent = logo

-- Logo text
local logoText = Instance.new("TextLabel")
logoText.Size = UDim2.new(1, 0, 0.4, 0)
logoText.Position = UDim2.new(0, 0, 0.6, 0)
logoText.BackgroundTransparency = 1
logoText.Text = "VIP"
logoText.TextColor3 = Color3.fromRGB(255, 255, 255)
logoText.Font = Enum.Font.GothamBold
logoText.TextSize = 12
logoText.TextXAlignment = Enum.TextXAlignment.Center
logoText.TextYAlignment = Enum.TextYAlignment.Center
logoText.Parent = logo

-- Logo glow effect
local logoGlow = Instance.new("Frame")
logoGlow.Size = UDim2.new(1, 20, 1, 20)
logoGlow.Position = UDim2.new(0, -10, 0, -10)
logoGlow.BackgroundColor3 = Color3.fromRGB(0, 255, 100)
logoGlow.BackgroundTransparency = 0.9
logoGlow.ZIndex = -1
logoGlow.Parent = logo

local logoGlowCorner = Instance.new("UICorner")
logoGlowCorner.CornerRadius = UDim.new(0, 20)
logoGlowCorner.Parent = logoGlow

-- Main menu frame (with minimum size constraints)
local menu = Instance.new("Frame")
menu.Size = UDim2.new(0, 420, 0, 280)
menu.Position = UDim2.new(0.5, -210, 0.5, -140)
menu.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
menu.Visible = false
menu.Active = true
menu.Parent = gui

-- Menu styling
local menuCorner = Instance.new("UICorner")
menuCorner.CornerRadius = UDim.new(0, 12)
menuCorner.Parent = menu

local menuStroke = Instance.new("UIStroke")
menuStroke.Color = Color3.fromRGB(0, 255, 0)
menuStroke.Thickness = 2
menuStroke.Parent = menu

-- Menu gradient
local menuGradient = Instance.new("UIGradient")
menuGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(20, 20, 20)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(30, 30, 30))
}
menuGradient.Rotation = 90
menuGradient.Parent = menu

-- Resize handle (bottom-right corner) - Fixed with proper resize icon
local resizeHandle = Instance.new("Frame")
resizeHandle.Size = UDim2.new(0, 20, 0, 20)
resizeHandle.Position = UDim2.new(1, -20, 1, -20)
resizeHandle.BackgroundTransparency = 1
resizeHandle.Parent = menu

-- Resize lines (proper resize indicator)
local resizeLine1 = Instance.new("Frame")
resizeLine1.Size = UDim2.new(0, 12, 0, 2)
resizeLine1.Position = UDim2.new(0, 4, 0, 14)
resizeLine1.BackgroundColor3 = Color3.fromRGB(150, 150, 150)
resizeLine1.BorderSizePixel = 0
resizeLine1.Parent = resizeHandle

local resizeLine2 = Instance.new("Frame")
resizeLine2.Size = UDim2.new(0, 8, 0, 2)
resizeLine2.Position = UDim2.new(0, 8, 0, 10)
resizeLine2.BackgroundColor3 = Color3.fromRGB(150, 150, 150)
resizeLine2.BorderSizePixel = 0
resizeLine2.Parent = resizeHandle

local resizeLine3 = Instance.new("Frame")
resizeLine3.Size = UDim2.new(0, 4, 0, 2)
resizeLine3.Position = UDim2.new(0, 12, 0, 6)
resizeLine3.BackgroundColor3 = Color3.fromRGB(150, 150, 150)
resizeLine3.BorderSizePixel = 0
resizeLine3.Parent = resizeHandle

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -80, 0, 40)
title.Position = UDim2.new(0, 40, 0, 5)
title.BackgroundTransparency = 1
title.Text = "WarpahVip | v.0.3.3.1"
title.TextColor3 = Color3.fromRGB(0, 255, 0)
title.TextSize = 16
title.Font = Enum.Font.GothamBold
title.TextXAlignment = Enum.TextXAlignment.Center
title.Parent = menu

-- Close button (X style)
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -35, 0, 5)
closeBtn.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
closeBtn.Text = "√ó"
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.TextSize = 20
closeBtn.Font = Enum.Font.GothamBold
closeBtn.Parent = menu

local closeBtnCorner = Instance.new("UICorner")
closeBtnCorner.CornerRadius = UDim.new(0, 4)
closeBtnCorner.Parent = closeBtn

-- Minimize button (- style)
local minBtn = Instance.new("TextButton")
minBtn.Size = UDim2.new(0, 30, 0, 30)
minBtn.Position = UDim2.new(1, -70, 0, 5)
minBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
minBtn.Text = "‚àí"
minBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
minBtn.TextSize = 20
minBtn.Font = Enum.Font.GothamBold
minBtn.Parent = menu

local minBtnCorner = Instance.new("UICorner")
minBtnCorner.CornerRadius = UDim.new(0, 4)
minBtnCorner.Parent = minBtn

-- Sidebar
local side = Instance.new("Frame")
side.Size = UDim2.new(0, 110, 1, -50)
side.Position = UDim2.new(0, 10, 0, 50)
side.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
side.Parent = menu

local sideCorner = Instance.new("UICorner")
sideCorner.CornerRadius = UDim.new(0, 8)
sideCorner.Parent = side

-- Cheat button
local cheatBtn = Instance.new("TextButton")
cheatBtn.Size = UDim2.new(1, -10, 0, 40)
cheatBtn.Position = UDim2.new(0, 5, 0, 10)
cheatBtn.Text = "üéÆ Cheat"
cheatBtn.BackgroundColor3 = Color3.fromRGB(0, 50, 0)
cheatBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
cheatBtn.Font = Enum.Font.GothamBold
cheatBtn.TextSize = 14
cheatBtn.Parent = side

local cheatBtnCorner = Instance.new("UICorner")
cheatBtnCorner.CornerRadius = UDim.new(0, 8)
cheatBtnCorner.Parent = cheatBtn

-- Device button (new)
local deviceBtn = Instance.new("TextButton")
deviceBtn.Size = UDim2.new(1, -10, 0, 40)
deviceBtn.Position = UDim2.new(0, 5, 0, 60)
deviceBtn.Text = "üì± Device"
deviceBtn.BackgroundColor3 = Color3.fromRGB(0, 50, 0)
deviceBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
deviceBtn.Font = Enum.Font.GothamBold
deviceBtn.TextSize = 14
deviceBtn.Parent = side

local deviceBtnCorner = Instance.new("UICorner")
deviceBtnCorner.CornerRadius = UDim.new(0, 8)
deviceBtnCorner.Parent = deviceBtn

-- Clear button (moved down)
local clearBtn = Instance.new("TextButton")
clearBtn.Size = UDim2.new(1, -10, 0, 40)
clearBtn.Position = UDim2.new(0, 5, 0, 110)
clearBtn.Text = "üßπ Clear"
clearBtn.BackgroundColor3 = Color3.fromRGB(0, 50, 0)
clearBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
clearBtn.Font = Enum.Font.GothamBold
clearBtn.TextSize = 14
clearBtn.Parent = side

local clearBtnCorner = Instance.new("UICorner")
clearBtnCorner.CornerRadius = UDim.new(0, 8)
clearBtnCorner.Parent = clearBtn

-- Back button
local backBtn = Instance.new("TextButton")
backBtn.Size = UDim2.new(1, -10, 0, 35)
backBtn.Position = UDim2.new(0, 5, 1, -45)
backBtn.BackgroundColor3 = Color3.fromRGB(0, 70, 0)
backBtn.Text = "‚Üê Kembali"
backBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
backBtn.Font = Enum.Font.Gotham
backBtn.TextSize = 13
backBtn.Visible = false
backBtn.Parent = side

local backBtnCorner = Instance.new("UICorner")
backBtnCorner.CornerRadius = UDim.new(0, 6)
backBtnCorner.Parent = backBtn

-- Content area
local content = Instance.new("ScrollingFrame")
content.Size = UDim2.new(1, -130, 1, -60)
content.Position = UDim2.new(0, 130, 0, 50)
content.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
content.ScrollBarThickness = 6
content.ScrollBarImageColor3 = Color3.fromRGB(0, 255, 0)
content.CanvasSize = UDim2.new(0, 0, 0, 0)
content.AutomaticCanvasSize = Enum.AutomaticSize.Y
content.Parent = menu

local contentCorner = Instance.new("UICorner")
contentCorner.CornerRadius = UDim.new(0, 8)
contentCorner.Parent = content

local contentLayout = Instance.new("UIListLayout")
contentLayout.SortOrder = Enum.SortOrder.LayoutOrder
contentLayout.Padding = UDim.new(0, 5)
contentLayout.Parent = content

local contentPadding = Instance.new("UIPadding")
contentPadding.PaddingTop = UDim.new(0, 10)
contentPadding.PaddingLeft = UDim.new(0, 10)
contentPadding.PaddingRight = UDim.new(0, 10)
contentPadding.Parent = content

-- Teleport coordinates - Updated with new mountains
local teleportPoints = {
    ["gn.sumbing"] = CFrame.new(-223, 441, 2114),
    ["gn.krakatau"] = CFrame.new(829, 307, 414),
    ["gn.ckptw"] = CFrame.new(1500, 500, 1000),
    ["gn.sibuatan"] = CFrame.new(-1000, 350, 2500),
    ["gn.lawak"] = CFrame.new(2000, 600, 1500),
    ["gn.yahaha"] = CFrame.new(-500, 400, 3000),
    ["gn.duntul"] = CFrame.new(3000, 700, 500),
    ["gn.atin"] = CFrame.new(-2000, 450, 1800),
    ["gn.sumala"] = CFrame.new(1200, 550, 2800)
}

-- Safe GUI clearing function
local function clearContent()
    for _, child in pairs(content:GetChildren()) do
        if child:IsA("GuiObject") and child ~= contentLayout and child ~= contentPadding then
            child:Destroy()
        end
    end
end

-- Create button function with error handling
local function createButton(text, callback, color)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -20, 0, 35)
    btn.BackgroundColor3 = color or Color3.fromRGB(20, 70, 20)
    btn.Text = text
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.TextSize = 13
    btn.Font = Enum.Font.Gotham
    btn.Parent = content
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 6)
    btnCorner.Parent = btn
    
    if callback then
        btn.MouseButton1Click:Connect(function()
            pcall(callback) -- Safe callback execution
        end)
    end
    
    return btn
end

-- Safe teleport function with better error handling
local function safeTeleport(targetCFrame, locationName)
    pcall(function()
        if player and player.Character then
            local humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
            if humanoidRootPart and targetCFrame then
                humanoidRootPart.CFrame = targetCFrame
                print("‚úÖ Teleport berhasil ke " .. locationName)
                return true
            end
        end
        warn("‚ùå Gagal teleport: Character atau HumanoidRootPart tidak ditemukan")
        return false
    end)
end

-- Auto peak menu - Updated with new mountains
local function showAutoPuncak()
    clearContent()
    currentMenu = "autopuncak"
    
    local gunungList = {
        { name = "gn.sumbing", display = "üèîÔ∏è Gunung Sumbing", emoji = "üèîÔ∏è" },
        { name = "gn.krakatau", display = "üåã Gunung Krakatau", emoji = "üåã" },
        { name = "gn.ckptw", display = "‚õ∞Ô∏è Gunung CKPTW", emoji = "‚õ∞Ô∏è" },
        { name = "gn.sibuatan", display = "üóª Gunung Sibuatan", emoji = "üóª" },
        { name = "gn.lawak", display = "üèïÔ∏è Gunung Lawak", emoji = "üèïÔ∏è" },
        { name = "gn.yahaha", display = "üéØ Gunung Yahaha", emoji = "üéØ" },
        { name = "gn.duntul", display = "üî• Gunung Duntul", emoji = "üî•" },
        { name = "gn.atin", display = "üíé Gunung Atin", emoji = "üíé" },
        { name = "gn.sumala", display = "‚ú® Gunung Sumala", emoji = "‚ú®" },
    }

    for _, g in ipairs(gunungList) do
        createButton(g.display, function()
            local targetCFrame = teleportPoints[g.name]
            if targetCFrame then
                safeTeleport(targetCFrame, g.display)
            else
                warn("‚ùå Koordinat tidak ditemukan untuk " .. g.display)
            end
        end, Color3.fromRGB(30, 60, 30))
    end
    backBtn.Visible = true
end

-- Fly mode menu (Fixed)
local function showFlyMenu()
    clearContent()
    currentMenu = "fly"
    
    local flyItems = {
        { 
            label = "‚úàÔ∏è Fly v1 (No Clip)", 
            callback = function()
                print("üöß Fly v1 No Clip - Coming Soon!")
            end 
        },
        { 
            label = "‚úàÔ∏è Fly v2 (Safe)", 
            callback = function() 
                print("üöß Fly v2 Safe - Coming Soon!") 
            end 
        },
    }

    for _, item in ipairs(flyItems) do
        createButton(item.label, item.callback, Color3.fromRGB(30, 70, 120))
    end
    backBtn.Visible = true
end

-- Device menu function
local function showDeviceMenu()
    clearContent()
    currentMenu = "device"
    
    local deviceItems = {
        { 
            label = "üîß Device Spoof", 
            callback = function() 
                print("üöß Device Spoof - Coming Soon!")
            end 
        },
        { 
            label = "üîÑ Rejoin Server", 
            callback = function()
                print("üîÑ Rejoining server...")
                local TeleportService = game:GetService("TeleportService")
                local placeId = game.PlaceId
                TeleportService:Teleport(placeId, player)
            end 
        },
        { 
            label = "üëÆ Detect Admin", 
            callback = function()
                print("üöß Admin Detector - Coming Soon!")
            end 
        },
    }

    for _, item in ipairs(deviceItems) do
        createButton(item.label, item.callback, Color3.fromRGB(40, 60, 80))
    end
    backBtn.Visible = true
end

-- Hide Name Visual menu
local function showHideNameMenu()
    clearContent()
    currentMenu = "hidename"
    
    -- Create text input
    local nameInput = Instance.new("TextBox")
    nameInput.Size = UDim2.new(1, -20, 0, 35)
    nameInput.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    nameInput.Text = "Enter new name..."
    nameInput.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameInput.TextSize = 13
    nameInput.Font = Enum.Font.Gotham
    nameInput.PlaceholderText = "Type your desired name here"
    nameInput.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
    nameInput.Parent = content
    
    local inputCorner = Instance.new("UICorner")
    inputCorner.CornerRadius = UDim.new(0, 6)
    inputCorner.Parent = nameInput
    
    local inputStroke = Instance.new("UIStroke")
    inputStroke.Color = Color3.fromRGB(0, 200, 100)
    inputStroke.Thickness = 1
    inputStroke.Parent = nameInput
    
    -- Generate button
    createButton("üé≠ Generate Name", function()
        local newName = nameInput.Text
        if newName and newName ~= "" and newName ~= "Enter new name..." then
            print("üé≠ Name changed to: " .. newName)
            print("üöß Hide Name Visual - Coming Soon!")
        else
            warn("‚ö†Ô∏è Please enter a valid name!")
        end
    end, Color3.fromRGB(0, 120, 60))
    
    -- Reset button
    createButton("üîÑ Reset to Original", function()
        print("üîÑ Name reset to original")
        print("üöß Reset Name - Coming Soon!")
    end, Color3.fromRGB(80, 80, 80))
    
    backBtn.Visible = true
end

-- Aimbot menu
local function showAimbotMenu()
    clearContent()
    currentMenu = "aimbot"
    
    createButton("üéØ Auto Aim", function()
        print("üöß Auto Aim - Coming Soon!")
    end, Color3.fromRGB(120, 40, 40))
    
    backBtn.Visible = true
end

local function showCheats()
    clearContent()
    currentMenu = "main"
    
    local items = {
        { label = "üèîÔ∏è Auto Puncak", callback = showAutoPuncak },
        { label = "‚ö° Auto Teleport", callback = function() 
            print("üöß Auto Teleport - Coming Soon!") 
        end },
        { label = "‚úàÔ∏è Fly Mode", callback = showFlyMenu },
        { label = "üèÉ Speed Run", callback = function()
            print("üöß Speed Run - Coming Soon!")
        end },
        { label = "‚ú® Radiant Body", callback = function()
            print("üöß Radiant Body - Coming Soon!")
        end },
        { label = "üéØ Fling Player", callback = function() 
            print("üöß Fling Player - Coming Soon!") 
        end },
        { label = "üë§ TP to Player", callback = function() 
            print("üöß TP to Player - Coming Soon!") 
        end },
        { label = "üé≠ Hide Name Visual", callback = showHideNameMenu },
        { label = "üéØ Aimbot", callback = showAimbotMenu },
    }

    for _, item in ipairs(items) do
        createButton(item.label, item.callback, Color3.fromRGB(45, 45, 45))
    end
    backBtn.Visible = false
end

-- Event connections with error handling
local function safeConnect(signal, callback)
    return signal:Connect(function(...)
        pcall(callback, ...)
    end)
end

-- Enhanced dragging system with better error handling
local function makeDraggable(frame)
    pcall(function()
        local dragToggle = false
        local dragStart = nil
        local startPos = nil
        
        -- For menu, use title area. For logo, use the frame itself
        local dragArea = (frame == menu) and title or frame
        
        local dragConnection = nil
        local inputConnection = nil
        
        dragConnection = safeConnect(dragArea.InputBegan, function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                dragToggle = true
                dragStart = input.Position
                startPos = frame.Position
                
                if inputConnection then
                    inputConnection:Disconnect()
                end
                
                inputConnection = safeConnect(input.Changed, function()
                    if input.UserInputState == Enum.UserInputState.End then 
                        dragToggle = false 
                    end
                end)
            end
        end)
        
        safeConnect(UIS.InputChanged, function(input)
            if dragToggle and dragStart and startPos and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                local delta = input.Position - dragStart
                frame.Position = UDim2.new(
                    startPos.X.Scale, 
                    startPos.X.Offset + delta.X, 
                    startPos.Y.Scale, 
                    startPos.Y.Offset + delta.Y
                )
            end
        end)
    end)
end

-- Enhanced resize system with better error handling
local function makeResizable(frame, minWidth, minHeight)
    pcall(function()
        local resizing = false
        local startSize = nil
        local startPos = nil
        local resizeConnection = nil
        
        resizeConnection = safeConnect(resizeHandle.InputBegan, function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                resizing = true
                startSize = frame.Size
                startPos = input.Position
                
                safeConnect(input.Changed, function()
                    if input.UserInputState == Enum.UserInputState.End then 
                        resizing = false 
                    end
                end)
            end
        end)
        
        safeConnect(UIS.InputChanged, function(input)
            if resizing and startSize and startPos and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                local delta = input.Position - startPos
                local newWidth = math.max(minWidth or 350, startSize.X.Offset + delta.X)
                local newHeight = math.max(minHeight or 250, startSize.Y.Offset + delta.Y)
                
                frame.Size = UDim2.new(0, newWidth, 0, newHeight)
            end
        end)
    end)
end

-- Current menu tracker
local currentMenu = "main"

-- Button events
safeConnect(cheatBtn.MouseButton1Click, function()
    showCheats()
end)

safeConnect(deviceBtn.MouseButton1Click, function()
    showDeviceMenu()
end)

safeConnect(backBtn.MouseButton1Click, function()
    if currentMenu == "fly" or currentMenu == "hidename" or currentMenu == "aimbot" or currentMenu == "autopuncak" or currentMenu == "device" then
        showCheats()
    else
        showCheats()
    end
end)

-- FIXED CLEAR FUNCTION - Safe cleanup without external scripts
safeConnect(clearBtn.MouseButton1Click, function()
    pcall(function()
        -- Simple hide menu and disable blur
        menu.Visible = false
        logo.Visible = true
        
        if blur then
            blur.Enabled = false
            blur.Size = 0
        end
        
        -- Clear content safely
        clearContent()
        
        print("‚úÖ GUI cleared successfully")
    end)
end)

safeConnect(logoButton.MouseButton1Click, function()
    pcall(function()
        menu.Visible = true
        if blur then
            blur.Enabled = true
            local tween = TweenService:Create(blur, TweenInfo.new(0.3, Enum.EasingStyle.Quad), { Size = 12 })
            tween:Play()
        end
        showCheats()
    end)
end)

safeConnect(minBtn.MouseButton1Click, function()
    pcall(function()
        menu.Visible = false
        if blur then
            blur.Enabled = false
            blur.Size = 0
        end
    end)
end)

safeConnect(closeBtn.MouseButton1Click, function()
    pcall(function()
        menu.Visible = false
        logo.Visible = false
        if blur then
            blur.Enabled = false
            blur.Size = 0
        end
    end)
end)

-- Logo pulsing animation with error handling
local function animateLogo()
    pcall(function()
        if logoGlow and logoIcon then
            local pulseIn = TweenService:Create(logoGlow, 
                TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), 
                { BackgroundTransparency = 0.7 }
            )
            pulseIn:Play()
            
            local iconPulse = TweenService:Create(logoIcon, 
                TweenInfo.new(2, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), 
                { TextSize = 28 }
            )
            iconPulse:Play()
        end
    end)
end

-- Apply dragging and resizing
makeDraggable(menu)
makeDraggable(logo) -- Fixed logo dragging
makeResizable(menu, 350, 250)

-- Start logo animation
animateLogo()

-- Initialize with main menu
showCheats()

-- Enhanced cleanup on player leaving with better error handling
safeConnect(player.AncestryChanged, function()
    if not player.Parent then
        pcall(function()
            -- Cleanup blur effect
            if blur and blur.Parent then
                blur:Destroy()
            end
            
            -- Cleanup GUI
            if gui and gui.Parent then
                gui:Destroy()
            end
            
            -- Additional cleanup for any orphaned effects
            local lighting = game:GetService("Lighting")
            for _, effect in pairs(lighting:GetChildren()) do
                if effect:IsA("BlurEffect") and effect.Name == "WarpahVipBlur" then
                    effect:Destroy()
                end
            end
        end)
    end
end)

-- Additional safety: Cleanup on script end
local function onScriptEnd()
    pcall(function()
        if blur and blur.Parent then
            blur:Destroy()
        end
        if gui and gui.Parent then
            gui:Destroy()
        end
    end)
end

-- Register cleanup
game:GetService("RunService").Heartbeat:Connect(function()
    if not gui or not gui.Parent then
        onScriptEnd()
    end
end)

print("‚úÖ WarpahVip GUI v0.3.3.1 Fixed loaded successfully!")
print("‚ú® Features: Fixed clear button, removed sub-menus for mountains")
print("üèîÔ∏è Added mountains: Sumbing, Krakatau, CKPTW, Sibuatan, Lawak, Yahaha, Duntul, Atin, Sumala")
print("üõ°Ô∏è Anti-lag: Improved memory management and error prevention")
